#include <stdio.h>
#include <stdint.h>
#include <string.h>
#include <openssl/aes.h>
#include <openssl/sha.h>

#define CEIL(x, y)  (int)((x + (y - 1)) / (y))

#define ROTL32(n, m)  do { \
		asm ( \
			"roll %1, %0\n\t" \
			: "=r"(n) \
			: "I"(m), "0"(n) \
		); \
	} while (0)

void hex_dump(uint8_t buf[], int len)
{
	int i;

	for (i = 1; i <= len; i++) {
		printf("%02x", buf[i - 1]);
		if (i % 32 == 0)
			printf("\n");
		else if (i % 4 == 0)
			printf(" ");
	}

	if ((i - 1) % 32 != 0)
		printf("\n");
	printf("\n");
}

#define AES_NB  4
#define MAX_NK  8
#define MAX_NR  14

#define _AES_BLOCK_SIZE  (AES_NB << 2)

typedef struct {
	uint8_t rd_key[(MAX_NR + 1) * AES_NB * 4];
	uint8_t inv_rd_key[(MAX_NR + 1) * AES_NB * 4];
	int rounds;
} _AES_KEY;

uint8_t c_i[32] = {
		"\x00\x01\x02\x04\x08\x10\x20\x40\x80\x1b\x36"
		"\x6c\xd8\xab\x4d\x9a\x2f\x5e\xbc\x63\xc6"
		"\x97\x35\x6a\xd4\xb3\x7d\xfa\xef\xc5\x91"
	};

uint8_t sbox[][16] = {
		"\x63\x7c\x77\x7b\xf2\x6b\x6f\xc5\x30\x01\x67\x2b\xfe\xd7\xab\x76",
		"\xca\x82\xc9\x7d\xfa\x59\x47\xf0\xad\xd4\xa2\xaf\x9c\xa4\x72\xc0",
		"\xb7\xfd\x93\x26\x36\x3f\xf7\xcc\x34\xa5\xe5\xf1\x71\xd8\x31\x15",
		"\x04\xc7\x23\xc3\x18\x96\x05\x9a\x07\x12\x80\xe2\xeb\x27\xb2\x75",
		"\x09\x83\x2c\x1a\x1b\x6e\x5a\xa0\x52\x3b\xd6\xb3\x29\xe3\x2f\x84",
		"\x53\xd1\x00\xed\x20\xfc\xb1\x5b\x6a\xcb\xbe\x39\x4a\x4c\x58\xcf",
		"\xd0\xef\xaa\xfb\x43\x4d\x33\x85\x45\xf9\x02\x7f\x50\x3c\x9f\xa8",
		"\x51\xa3\x40\x8f\x92\x9d\x38\xf5\xbc\xb6\xda\x21\x10\xff\xf3\xd2",
		"\xcd\x0c\x13\xec\x5f\x97\x44\x17\xc4\xa7\x7e\x3d\x64\x5d\x19\x73",
		"\x60\x81\x4f\xdc\x22\x2a\x90\x88\x46\xee\xb8\x14\xde\x5e\x0b\xdb",
		"\xe0\x32\x3a\x0a\x49\x06\x24\x5c\xc2\xd3\xac\x62\x91\x95\xe4\x79",
		"\xe7\xc8\x37\x6d\x8d\xd5\x4e\xa9\x6c\x56\xf4\xea\x65\x7a\xae\x08",
		"\xba\x78\x25\x2e\x1c\xa6\xb4\xc6\xe8\xdd\x74\x1f\x4b\xbd\x8b\x8a",
		"\x70\x3e\xb5\x66\x48\x03\xf6\x0e\x61\x35\x57\xb9\x86\xc1\x1d\x9e",
		"\xe1\xf8\x98\x11\x69\xd9\x8e\x94\x9b\x1e\x87\xe9\xce\x55\x28\xdf",
		"\x8c\xa1\x89\x0d\xbf\xe6\x42\x68\x41\x99\x2d\x0f\xb0\x54\xbb\x16"
	};

uint8_t inv_sbox[][16] = {
		"\x52\x09\x6a\xd5\x30\x36\xa5\x38\xbf\x40\xa3\x9e\x81\xf3\xd7\xfb",
		"\x7c\xe3\x39\x82\x9b\x2f\xff\x87\x34\x8e\x43\x44\xc4\xde\xe9\xcb",
		"\x54\x7b\x94\x32\xa6\xc2\x23\x3d\xee\x4c\x95\x0b\x42\xfa\xc3\x4e",
		"\x08\x2e\xa1\x66\x28\xd9\x24\xb2\x76\x5b\xa2\x49\x6d\x8b\xd1\x25",
		"\x72\xf8\xf6\x64\x86\x68\x98\x16\xd4\xa4\x5c\xcc\x5d\x65\xb6\x92",
		"\x6c\x70\x48\x50\xfd\xed\xb9\xda\x5e\x15\x46\x57\xa7\x8d\x9d\x84",
		"\x90\xd8\xab\x00\x8c\xbc\xd3\x0a\xf7\xe4\x58\x05\xb8\xb3\x45\x06",
		"\xd0\x2c\x1e\x8f\xca\x3f\x0f\x02\xc1\xaf\xbd\x03\x01\x13\x8a\x6b",
		"\x3a\x91\x11\x41\x4f\x67\xdc\xea\x97\xf2\xcf\xce\xf0\xb4\xe6\x73",
		"\x96\xac\x74\x22\xe7\xad\x35\x85\xe2\xf9\x37\xe8\x1c\x75\xdf\x6e",
		"\x47\xf1\x1a\x71\x1d\x29\xc5\x89\x6f\xb7\x62\x0e\xaa\x18\xbe\x1b",
		"\xfc\x56\x3e\x4b\xc6\xd2\x79\x20\x9a\xdb\xc0\xfe\x78\xcd\x5a\xf4",
		"\x1f\xdd\xa8\x33\x88\x07\xc7\x31\xb1\x12\x10\x59\x27\x80\xec\x5f",
		"\x60\x51\x7f\xa9\x19\xb5\x4a\x0d\x2d\xe5\x7a\x9f\x93\xc9\x9c\xef",
		"\xa0\xe0\x3b\x4d\xae\x2a\xf5\xb0\xc8\xeb\xbb\x3c\x83\x53\x99\x61",
		"\x17\x2b\x04\x7e\xba\x77\xd6\x26\xe1\x69\x14\x63\x55\x21\x0c\x7d"
	};

uint8_t *mixcol_tab[][16] = {
		{
			"\x00\x00\x00\x00", "\x02\x01\x01\x03",
			"\x04\x02\x02\x06", "\x06\x03\x03\x05",
			"\x08\x04\x04\x0c", "\x0a\x05\x05\x0f",
			"\x0c\x06\x06\x0a", "\x0e\x07\x07\x09",
			"\x10\x08\x08\x18", "\x12\x09\x09\x1b",
			"\x14\x0a\x0a\x1e", "\x16\x0b\x0b\x1d",
			"\x18\x0c\x0c\x14", "\x1a\x0d\x0d\x17",
			"\x1c\x0e\x0e\x12", "\x1e\x0f\x0f\x11",
		},
		{
			"\x20\x10\x10\x30", "\x22\x11\x11\x33",
			"\x24\x12\x12\x36", "\x26\x13\x13\x35",
			"\x28\x14\x14\x3c", "\x2a\x15\x15\x3f",
			"\x2c\x16\x16\x3a", "\x2e\x17\x17\x39",
			"\x30\x18\x18\x28", "\x32\x19\x19\x2b",
			"\x34\x1a\x1a\x2e", "\x36\x1b\x1b\x2d",
			"\x38\x1c\x1c\x24", "\x3a\x1d\x1d\x27",
			"\x3c\x1e\x1e\x22", "\x3e\x1f\x1f\x21",
		},
		{
			"\x40\x20\x20\x60", "\x42\x21\x21\x63",
			"\x44\x22\x22\x66", "\x46\x23\x23\x65",
			"\x48\x24\x24\x6c", "\x4a\x25\x25\x6f",
			"\x4c\x26\x26\x6a", "\x4e\x27\x27\x69",
			"\x50\x28\x28\x78", "\x52\x29\x29\x7b",
			"\x54\x2a\x2a\x7e", "\x56\x2b\x2b\x7d",
			"\x58\x2c\x2c\x74", "\x5a\x2d\x2d\x77",
			"\x5c\x2e\x2e\x72", "\x5e\x2f\x2f\x71",
		},
		{
			"\x60\x30\x30\x50", "\x62\x31\x31\x53",
			"\x64\x32\x32\x56", "\x66\x33\x33\x55",
			"\x68\x34\x34\x5c", "\x6a\x35\x35\x5f",
			"\x6c\x36\x36\x5a", "\x6e\x37\x37\x59",
			"\x70\x38\x38\x48", "\x72\x39\x39\x4b",
			"\x74\x3a\x3a\x4e", "\x76\x3b\x3b\x4d",
			"\x78\x3c\x3c\x44", "\x7a\x3d\x3d\x47",
			"\x7c\x3e\x3e\x42", "\x7e\x3f\x3f\x41",
		},
		{
			"\x80\x40\x40\xc0", "\x82\x41\x41\xc3",
			"\x84\x42\x42\xc6", "\x86\x43\x43\xc5",
			"\x88\x44\x44\xcc", "\x8a\x45\x45\xcf",
			"\x8c\x46\x46\xca", "\x8e\x47\x47\xc9",
			"\x90\x48\x48\xd8", "\x92\x49\x49\xdb",
			"\x94\x4a\x4a\xde", "\x96\x4b\x4b\xdd",
			"\x98\x4c\x4c\xd4", "\x9a\x4d\x4d\xd7",
			"\x9c\x4e\x4e\xd2", "\x9e\x4f\x4f\xd1",
		},
		{
			"\xa0\x50\x50\xf0", "\xa2\x51\x51\xf3",
			"\xa4\x52\x52\xf6", "\xa6\x53\x53\xf5",
			"\xa8\x54\x54\xfc", "\xaa\x55\x55\xff",
			"\xac\x56\x56\xfa", "\xae\x57\x57\xf9",
			"\xb0\x58\x58\xe8", "\xb2\x59\x59\xeb",
			"\xb4\x5a\x5a\xee", "\xb6\x5b\x5b\xed",
			"\xb8\x5c\x5c\xe4", "\xba\x5d\x5d\xe7",
			"\xbc\x5e\x5e\xe2", "\xbe\x5f\x5f\xe1",
		},
		{
			"\xc0\x60\x60\xa0", "\xc2\x61\x61\xa3",
			"\xc4\x62\x62\xa6", "\xc6\x63\x63\xa5",
			"\xc8\x64\x64\xac", "\xca\x65\x65\xaf",
			"\xcc\x66\x66\xaa", "\xce\x67\x67\xa9",
			"\xd0\x68\x68\xb8", "\xd2\x69\x69\xbb",
			"\xd4\x6a\x6a\xbe", "\xd6\x6b\x6b\xbd",
			"\xd8\x6c\x6c\xb4", "\xda\x6d\x6d\xb7",
			"\xdc\x6e\x6e\xb2", "\xde\x6f\x6f\xb1",
		},
		{
			"\xe0\x70\x70\x90", "\xe2\x71\x71\x93",
			"\xe4\x72\x72\x96", "\xe6\x73\x73\x95",
			"\xe8\x74\x74\x9c", "\xea\x75\x75\x9f",
			"\xec\x76\x76\x9a", "\xee\x77\x77\x99",
			"\xf0\x78\x78\x88", "\xf2\x79\x79\x8b",
			"\xf4\x7a\x7a\x8e", "\xf6\x7b\x7b\x8d",
			"\xf8\x7c\x7c\x84", "\xfa\x7d\x7d\x87",
			"\xfc\x7e\x7e\x82", "\xfe\x7f\x7f\x81",
		},
		{
			"\x1b\x80\x80\x9b", "\x19\x81\x81\x98",
			"\x1f\x82\x82\x9d", "\x1d\x83\x83\x9e",
			"\x13\x84\x84\x97", "\x11\x85\x85\x94",
			"\x17\x86\x86\x91", "\x15\x87\x87\x92",
			"\x0b\x88\x88\x83", "\x09\x89\x89\x80",
			"\x0f\x8a\x8a\x85", "\x0d\x8b\x8b\x86",
			"\x03\x8c\x8c\x8f", "\x01\x8d\x8d\x8c",
			"\x07\x8e\x8e\x89", "\x05\x8f\x8f\x8a",
		},
		{
			"\x3b\x90\x90\xab", "\x39\x91\x91\xa8",
			"\x3f\x92\x92\xad", "\x3d\x93\x93\xae",
			"\x33\x94\x94\xa7", "\x31\x95\x95\xa4",
			"\x37\x96\x96\xa1", "\x35\x97\x97\xa2",
			"\x2b\x98\x98\xb3", "\x29\x99\x99\xb0",
			"\x2f\x9a\x9a\xb5", "\x2d\x9b\x9b\xb6",
			"\x23\x9c\x9c\xbf", "\x21\x9d\x9d\xbc",
			"\x27\x9e\x9e\xb9", "\x25\x9f\x9f\xba",
		},
		{
			"\x5b\xa0\xa0\xfb", "\x59\xa1\xa1\xf8",
			"\x5f\xa2\xa2\xfd", "\x5d\xa3\xa3\xfe",
			"\x53\xa4\xa4\xf7", "\x51\xa5\xa5\xf4",
			"\x57\xa6\xa6\xf1", "\x55\xa7\xa7\xf2",
			"\x4b\xa8\xa8\xe3", "\x49\xa9\xa9\xe0",
			"\x4f\xaa\xaa\xe5", "\x4d\xab\xab\xe6",
			"\x43\xac\xac\xef", "\x41\xad\xad\xec",
			"\x47\xae\xae\xe9", "\x45\xaf\xaf\xea",
		},
		{
			"\x7b\xb0\xb0\xcb", "\x79\xb1\xb1\xc8",
			"\x7f\xb2\xb2\xcd", "\x7d\xb3\xb3\xce",
			"\x73\xb4\xb4\xc7", "\x71\xb5\xb5\xc4",
			"\x77\xb6\xb6\xc1", "\x75\xb7\xb7\xc2",
			"\x6b\xb8\xb8\xd3", "\x69\xb9\xb9\xd0",
			"\x6f\xba\xba\xd5", "\x6d\xbb\xbb\xd6",
			"\x63\xbc\xbc\xdf", "\x61\xbd\xbd\xdc",
			"\x67\xbe\xbe\xd9", "\x65\xbf\xbf\xda",
		},
		{
			"\x9b\xc0\xc0\x5b", "\x99\xc1\xc1\x58",
			"\x9f\xc2\xc2\x5d", "\x9d\xc3\xc3\x5e",
			"\x93\xc4\xc4\x57", "\x91\xc5\xc5\x54",
			"\x97\xc6\xc6\x51", "\x95\xc7\xc7\x52",
			"\x8b\xc8\xc8\x43", "\x89\xc9\xc9\x40",
			"\x8f\xca\xca\x45", "\x8d\xcb\xcb\x46",
			"\x83\xcc\xcc\x4f", "\x81\xcd\xcd\x4c",
			"\x87\xce\xce\x49", "\x85\xcf\xcf\x4a",
		},
		{
			"\xbb\xd0\xd0\x6b", "\xb9\xd1\xd1\x68",
			"\xbf\xd2\xd2\x6d", "\xbd\xd3\xd3\x6e",
			"\xb3\xd4\xd4\x67", "\xb1\xd5\xd5\x64",
			"\xb7\xd6\xd6\x61", "\xb5\xd7\xd7\x62",
			"\xab\xd8\xd8\x73", "\xa9\xd9\xd9\x70",
			"\xaf\xda\xda\x75", "\xad\xdb\xdb\x76",
			"\xa3\xdc\xdc\x7f", "\xa1\xdd\xdd\x7c",
			"\xa7\xde\xde\x79", "\xa5\xdf\xdf\x7a",
		},
		{
			"\xdb\xe0\xe0\x3b", "\xd9\xe1\xe1\x38",
			"\xdf\xe2\xe2\x3d", "\xdd\xe3\xe3\x3e",
			"\xd3\xe4\xe4\x37", "\xd1\xe5\xe5\x34",
			"\xd7\xe6\xe6\x31", "\xd5\xe7\xe7\x32",
			"\xcb\xe8\xe8\x23", "\xc9\xe9\xe9\x20",
			"\xcf\xea\xea\x25", "\xcd\xeb\xeb\x26",
			"\xc3\xec\xec\x2f", "\xc1\xed\xed\x2c",
			"\xc7\xee\xee\x29", "\xc5\xef\xef\x2a",
		},
		{
			"\xfb\xf0\xf0\x0b", "\xf9\xf1\xf1\x08",
			"\xff\xf2\xf2\x0d", "\xfd\xf3\xf3\x0e",
			"\xf3\xf4\xf4\x07", "\xf1\xf5\xf5\x04",
			"\xf7\xf6\xf6\x01", "\xf5\xf7\xf7\x02",
			"\xeb\xf8\xf8\x13", "\xe9\xf9\xf9\x10",
			"\xef\xfa\xfa\x15", "\xed\xfb\xfb\x16",
			"\xe3\xfc\xfc\x1f", "\xe1\xfd\xfd\x1c",
			"\xe7\xfe\xfe\x19", "\xe5\xff\xff\x1a",
		},
	};

uint8_t *inv_mixcol_tab[][16] = {
		{
			"\x00\x00\x00\x00", "\x0e\x09\x0d\x0b",
			"\x1c\x12\x1a\x16", "\x12\x1b\x17\x1d",
			"\x38\x24\x34\x2c", "\x36\x2d\x39\x27",
			"\x24\x36\x2e\x3a", "\x2a\x3f\x23\x31",
			"\x70\x48\x68\x58", "\x7e\x41\x65\x53",
			"\x6c\x5a\x72\x4e", "\x62\x53\x7f\x45",
			"\x48\x6c\x5c\x74", "\x46\x65\x51\x7f",
			"\x54\x7e\x46\x62", "\x5a\x77\x4b\x69",
		},
		{
			"\xe0\x90\xd0\xb0", "\xee\x99\xdd\xbb",
			"\xfc\x82\xca\xa6", "\xf2\x8b\xc7\xad",
			"\xd8\xb4\xe4\x9c", "\xd6\xbd\xe9\x97",
			"\xc4\xa6\xfe\x8a", "\xca\xaf\xf3\x81",
			"\x90\xd8\xb8\xe8", "\x9e\xd1\xb5\xe3",
			"\x8c\xca\xa2\xfe", "\x82\xc3\xaf\xf5",
			"\xa8\xfc\x8c\xc4", "\xa6\xf5\x81\xcf",
			"\xb4\xee\x96\xd2", "\xba\xe7\x9b\xd9",
		},
		{
			"\xdb\x3b\xbb\x7b", "\xd5\x32\xb6\x70",
			"\xc7\x29\xa1\x6d", "\xc9\x20\xac\x66",
			"\xe3\x1f\x8f\x57", "\xed\x16\x82\x5c",
			"\xff\x0d\x95\x41", "\xf1\x04\x98\x4a",
			"\xab\x73\xd3\x23", "\xa5\x7a\xde\x28",
			"\xb7\x61\xc9\x35", "\xb9\x68\xc4\x3e",
			"\x93\x57\xe7\x0f", "\x9d\x5e\xea\x04",
			"\x8f\x45\xfd\x19", "\x81\x4c\xf0\x12",
		},
		{
			"\x3b\xab\x6b\xcb", "\x35\xa2\x66\xc0",
			"\x27\xb9\x71\xdd", "\x29\xb0\x7c\xd6",
			"\x03\x8f\x5f\xe7", "\x0d\x86\x52\xec",
			"\x1f\x9d\x45\xf1", "\x11\x94\x48\xfa",
			"\x4b\xe3\x03\x93", "\x45\xea\x0e\x98",
			"\x57\xf1\x19\x85", "\x59\xf8\x14\x8e",
			"\x73\xc7\x37\xbf", "\x7d\xce\x3a\xb4",
			"\x6f\xd5\x2d\xa9", "\x61\xdc\x20\xa2",
		},
		{
			"\xad\x76\x6d\xf6", "\xa3\x7f\x60\xfd",
			"\xb1\x64\x77\xe0", "\xbf\x6d\x7a\xeb",
			"\x95\x52\x59\xda", "\x9b\x5b\x54\xd1",
			"\x89\x40\x43\xcc", "\x87\x49\x4e\xc7",
			"\xdd\x3e\x05\xae", "\xd3\x37\x08\xa5",
			"\xc1\x2c\x1f\xb8", "\xcf\x25\x12\xb3",
			"\xe5\x1a\x31\x82", "\xeb\x13\x3c\x89",
			"\xf9\x08\x2b\x94", "\xf7\x01\x26\x9f",
		},
		{
			"\x4d\xe6\xbd\x46", "\x43\xef\xb0\x4d",
			"\x51\xf4\xa7\x50", "\x5f\xfd\xaa\x5b",
			"\x75\xc2\x89\x6a", "\x7b\xcb\x84\x61",
			"\x69\xd0\x93\x7c", "\x67\xd9\x9e\x77",
			"\x3d\xae\xd5\x1e", "\x33\xa7\xd8\x15",
			"\x21\xbc\xcf\x08", "\x2f\xb5\xc2\x03",
			"\x05\x8a\xe1\x32", "\x0b\x83\xec\x39",
			"\x19\x98\xfb\x24", "\x17\x91\xf6\x2f",
		},
		{
			"\x76\x4d\xd6\x8d", "\x78\x44\xdb\x86",
			"\x6a\x5f\xcc\x9b", "\x64\x56\xc1\x90",
			"\x4e\x69\xe2\xa1", "\x40\x60\xef\xaa",
			"\x52\x7b\xf8\xb7", "\x5c\x72\xf5\xbc",
			"\x06\x05\xbe\xd5", "\x08\x0c\xb3\xde",
			"\x1a\x17\xa4\xc3", "\x14\x1e\xa9\xc8",
			"\x3e\x21\x8a\xf9", "\x30\x28\x87\xf2",
			"\x22\x33\x90\xef", "\x2c\x3a\x9d\xe4",
		},
		{
			"\x96\xdd\x06\x3d", "\x98\xd4\x0b\x36",
			"\x8a\xcf\x1c\x2b", "\x84\xc6\x11\x20",
			"\xae\xf9\x32\x11", "\xa0\xf0\x3f\x1a",
			"\xb2\xeb\x28\x07", "\xbc\xe2\x25\x0c",
			"\xe6\x95\x6e\x65", "\xe8\x9c\x63\x6e",
			"\xfa\x87\x74\x73", "\xf4\x8e\x79\x78",
			"\xde\xb1\x5a\x49", "\xd0\xb8\x57\x42",
			"\xc2\xa3\x40\x5f", "\xcc\xaa\x4d\x54",
		},
		{
			"\x41\xec\xda\xf7", "\x4f\xe5\xd7\xfc",
			"\x5d\xfe\xc0\xe1", "\x53\xf7\xcd\xea",
			"\x79\xc8\xee\xdb", "\x77\xc1\xe3\xd0",
			"\x65\xda\xf4\xcd", "\x6b\xd3\xf9\xc6",
			"\x31\xa4\xb2\xaf", "\x3f\xad\xbf\xa4",
			"\x2d\xb6\xa8\xb9", "\x23\xbf\xa5\xb2",
			"\x09\x80\x86\x83", "\x07\x89\x8b\x88",
			"\x15\x92\x9c\x95", "\x1b\x9b\x91\x9e",
		},
		{
			"\xa1\x7c\x0a\x47", "\xaf\x75\x07\x4c",
			"\xbd\x6e\x10\x51", "\xb3\x67\x1d\x5a",
			"\x99\x58\x3e\x6b", "\x97\x51\x33\x60",
			"\x85\x4a\x24\x7d", "\x8b\x43\x29\x76",
			"\xd1\x34\x62\x1f", "\xdf\x3d\x6f\x14",
			"\xcd\x26\x78\x09", "\xc3\x2f\x75\x02",
			"\xe9\x10\x56\x33", "\xe7\x19\x5b\x38",
			"\xf5\x02\x4c\x25", "\xfb\x0b\x41\x2e",
		},
		{
			"\x9a\xd7\x61\x8c", "\x94\xde\x6c\x87",
			"\x86\xc5\x7b\x9a", "\x88\xcc\x76\x91",
			"\xa2\xf3\x55\xa0", "\xac\xfa\x58\xab",
			"\xbe\xe1\x4f\xb6", "\xb0\xe8\x42\xbd",
			"\xea\x9f\x09\xd4", "\xe4\x96\x04\xdf",
			"\xf6\x8d\x13\xc2", "\xf8\x84\x1e\xc9",
			"\xd2\xbb\x3d\xf8", "\xdc\xb2\x30\xf3",
			"\xce\xa9\x27\xee", "\xc0\xa0\x2a\xe5",
		},
		{
			"\x7a\x47\xb1\x3c", "\x74\x4e\xbc\x37",
			"\x66\x55\xab\x2a", "\x68\x5c\xa6\x21",
			"\x42\x63\x85\x10", "\x4c\x6a\x88\x1b",
			"\x5e\x71\x9f\x06", "\x50\x78\x92\x0d",
			"\x0a\x0f\xd9\x64", "\x04\x06\xd4\x6f",
			"\x16\x1d\xc3\x72", "\x18\x14\xce\x79",
			"\x32\x2b\xed\x48", "\x3c\x22\xe0\x43",
			"\x2e\x39\xf7\x5e", "\x20\x30\xfa\x55",
		},
		{
			"\xec\x9a\xb7\x01", "\xe2\x93\xba\x0a",
			"\xf0\x88\xad\x17", "\xfe\x81\xa0\x1c",
			"\xd4\xbe\x83\x2d", "\xda\xb7\x8e\x26",
			"\xc8\xac\x99\x3b", "\xc6\xa5\x94\x30",
			"\x9c\xd2\xdf\x59", "\x92\xdb\xd2\x52",
			"\x80\xc0\xc5\x4f", "\x8e\xc9\xc8\x44",
			"\xa4\xf6\xeb\x75", "\xaa\xff\xe6\x7e",
			"\xb8\xe4\xf1\x63", "\xb6\xed\xfc\x68",
		},
		{
			"\x0c\x0a\x67\xb1", "\x02\x03\x6a\xba",
			"\x10\x18\x7d\xa7", "\x1e\x11\x70\xac",
			"\x34\x2e\x53\x9d", "\x3a\x27\x5e\x96",
			"\x28\x3c\x49\x8b", "\x26\x35\x44\x80",
			"\x7c\x42\x0f\xe9", "\x72\x4b\x02\xe2",
			"\x60\x50\x15\xff", "\x6e\x59\x18\xf4",
			"\x44\x66\x3b\xc5", "\x4a\x6f\x36\xce",
			"\x58\x74\x21\xd3", "\x56\x7d\x2c\xd8",
		},
		{
			"\x37\xa1\x0c\x7a", "\x39\xa8\x01\x71",
			"\x2b\xb3\x16\x6c", "\x25\xba\x1b\x67",
			"\x0f\x85\x38\x56", "\x01\x8c\x35\x5d",
			"\x13\x97\x22\x40", "\x1d\x9e\x2f\x4b",
			"\x47\xe9\x64\x22", "\x49\xe0\x69\x29",
			"\x5b\xfb\x7e\x34", "\x55\xf2\x73\x3f",
			"\x7f\xcd\x50\x0e", "\x71\xc4\x5d\x05",
			"\x63\xdf\x4a\x18", "\x6d\xd6\x47\x13",
		},
		{
			"\xd7\x31\xdc\xca", "\xd9\x38\xd1\xc1",
			"\xcb\x23\xc6\xdc", "\xc5\x2a\xcb\xd7",
			"\xef\x15\xe8\xe6", "\xe1\x1c\xe5\xed",
			"\xf3\x07\xf2\xf0", "\xfd\x0e\xff\xfb",
			"\xa7\x79\xb4\x92", "\xa9\x70\xb9\x99",
			"\xbb\x6b\xae\x84", "\xb5\x62\xa3\x8f",
			"\x9f\x5d\x80\xbe", "\x91\x54\x8d\xb5",
			"\x83\x4f\x9a\xa8", "\x8d\x46\x97\xa3",
		},
	};

uint8_t *comb_mixcol_tab[][16] = {
		{
			"\xc6\x63\x63\xa5", "\xf8\x7c\x7c\x84",
			"\xee\x77\x77\x99", "\xf6\x7b\x7b\x8d",
			"\xff\xf2\xf2\x0d", "\xd6\x6b\x6b\xbd",
			"\xde\x6f\x6f\xb1", "\x91\xc5\xc5\x54",
			"\x60\x30\x30\x50", "\x02\x01\x01\x03",
			"\xce\x67\x67\xa9", "\x56\x2b\x2b\x7d",
			"\xe7\xfe\xfe\x19", "\xb5\xd7\xd7\x62",
			"\x4d\xab\xab\xe6", "\xec\x76\x76\x9a",
		},
		{
			"\x8f\xca\xca\x45", "\x1f\x82\x82\x9d",
			"\x89\xc9\xc9\x40", "\xfa\x7d\x7d\x87",
			"\xef\xfa\xfa\x15", "\xb2\x59\x59\xeb",
			"\x8e\x47\x47\xc9", "\xfb\xf0\xf0\x0b",
			"\x41\xad\xad\xec", "\xb3\xd4\xd4\x67",
			"\x5f\xa2\xa2\xfd", "\x45\xaf\xaf\xea",
			"\x23\x9c\x9c\xbf", "\x53\xa4\xa4\xf7",
			"\xe4\x72\x72\x96", "\x9b\xc0\xc0\x5b",
		},
		{
			"\x75\xb7\xb7\xc2", "\xe1\xfd\xfd\x1c",
			"\x3d\x93\x93\xae", "\x4c\x26\x26\x6a",
			"\x6c\x36\x36\x5a", "\x7e\x3f\x3f\x41",
			"\xf5\xf7\xf7\x02", "\x83\xcc\xcc\x4f",
			"\x68\x34\x34\x5c", "\x51\xa5\xa5\xf4",
			"\xd1\xe5\xe5\x34", "\xf9\xf1\xf1\x08",
			"\xe2\x71\x71\x93", "\xab\xd8\xd8\x73",
			"\x62\x31\x31\x53", "\x2a\x15\x15\x3f",
		},
		{
			"\x08\x04\x04\x0c", "\x95\xc7\xc7\x52",
			"\x46\x23\x23\x65", "\x9d\xc3\xc3\x5e",
			"\x30\x18\x18\x28", "\x37\x96\x96\xa1",
			"\x0a\x05\x05\x0f", "\x2f\x9a\x9a\xb5",
			"\x0e\x07\x07\x09", "\x24\x12\x12\x36",
			"\x1b\x80\x80\x9b", "\xdf\xe2\xe2\x3d",
			"\xcd\xeb\xeb\x26", "\x4e\x27\x27\x69",
			"\x7f\xb2\xb2\xcd", "\xea\x75\x75\x9f",
		},
		{
			"\x12\x09\x09\x1b", "\x1d\x83\x83\x9e",
			"\x58\x2c\x2c\x74", "\x34\x1a\x1a\x2e",
			"\x36\x1b\x1b\x2d", "\xdc\x6e\x6e\xb2",
			"\xb4\x5a\x5a\xee", "\x5b\xa0\xa0\xfb",
			"\xa4\x52\x52\xf6", "\x76\x3b\x3b\x4d",
			"\xb7\xd6\xd6\x61", "\x7d\xb3\xb3\xce",
			"\x52\x29\x29\x7b", "\xdd\xe3\xe3\x3e",
			"\x5e\x2f\x2f\x71", "\x13\x84\x84\x97",
		},
		{
			"\xa6\x53\x53\xf5", "\xb9\xd1\xd1\x68",
			"\x00\x00\x00\x00", "\xc1\xed\xed\x2c",
			"\x40\x20\x20\x60", "\xe3\xfc\xfc\x1f",
			"\x79\xb1\xb1\xc8", "\xb6\x5b\x5b\xed",
			"\xd4\x6a\x6a\xbe", "\x8d\xcb\xcb\x46",
			"\x67\xbe\xbe\xd9", "\x72\x39\x39\x4b",
			"\x94\x4a\x4a\xde", "\x98\x4c\x4c\xd4",
			"\xb0\x58\x58\xe8", "\x85\xcf\xcf\x4a",
		},
		{
			"\xbb\xd0\xd0\x6b", "\xc5\xef\xef\x2a",
			"\x4f\xaa\xaa\xe5", "\xed\xfb\xfb\x16",
			"\x86\x43\x43\xc5", "\x9a\x4d\x4d\xd7",
			"\x66\x33\x33\x55", "\x11\x85\x85\x94",
			"\x8a\x45\x45\xcf", "\xe9\xf9\xf9\x10",
			"\x04\x02\x02\x06", "\xfe\x7f\x7f\x81",
			"\xa0\x50\x50\xf0", "\x78\x3c\x3c\x44",
			"\x25\x9f\x9f\xba", "\x4b\xa8\xa8\xe3",
		},
		{
			"\xa2\x51\x51\xf3", "\x5d\xa3\xa3\xfe",
			"\x80\x40\x40\xc0", "\x05\x8f\x8f\x8a",
			"\x3f\x92\x92\xad", "\x21\x9d\x9d\xbc",
			"\x70\x38\x38\x48", "\xf1\xf5\xf5\x04",
			"\x63\xbc\xbc\xdf", "\x77\xb6\xb6\xc1",
			"\xaf\xda\xda\x75", "\x42\x21\x21\x63",
			"\x20\x10\x10\x30", "\xe5\xff\xff\x1a",
			"\xfd\xf3\xf3\x0e", "\xbf\xd2\xd2\x6d",
		},
		{
			"\x81\xcd\xcd\x4c", "\x18\x0c\x0c\x14",
			"\x26\x13\x13\x35", "\xc3\xec\xec\x2f",
			"\xbe\x5f\x5f\xe1", "\x35\x97\x97\xa2",
			"\x88\x44\x44\xcc", "\x2e\x17\x17\x39",
			"\x93\xc4\xc4\x57", "\x55\xa7\xa7\xf2",
			"\xfc\x7e\x7e\x82", "\x7a\x3d\x3d\x47",
			"\xc8\x64\x64\xac", "\xba\x5d\x5d\xe7",
			"\x32\x19\x19\x2b", "\xe6\x73\x73\x95",
		},
		{
			"\xc0\x60\x60\xa0", "\x19\x81\x81\x98",
			"\x9e\x4f\x4f\xd1", "\xa3\xdc\xdc\x7f",
			"\x44\x22\x22\x66", "\x54\x2a\x2a\x7e",
			"\x3b\x90\x90\xab", "\x0b\x88\x88\x83",
			"\x8c\x46\x46\xca", "\xc7\xee\xee\x29",
			"\x6b\xb8\xb8\xd3", "\x28\x14\x14\x3c",
			"\xa7\xde\xde\x79", "\xbc\x5e\x5e\xe2",
			"\x16\x0b\x0b\x1d", "\xad\xdb\xdb\x76",
		},
		{
			"\xdb\xe0\xe0\x3b", "\x64\x32\x32\x56",
			"\x74\x3a\x3a\x4e", "\x14\x0a\x0a\x1e",
			"\x92\x49\x49\xdb", "\x0c\x06\x06\x0a",
			"\x48\x24\x24\x6c", "\xb8\x5c\x5c\xe4",
			"\x9f\xc2\xc2\x5d", "\xbd\xd3\xd3\x6e",
			"\x43\xac\xac\xef", "\xc4\x62\x62\xa6",
			"\x39\x91\x91\xa8", "\x31\x95\x95\xa4",
			"\xd3\xe4\xe4\x37", "\xf2\x79\x79\x8b",
		},
		{
			"\xd5\xe7\xe7\x32", "\x8b\xc8\xc8\x43",
			"\x6e\x37\x37\x59", "\xda\x6d\x6d\xb7",
			"\x01\x8d\x8d\x8c", "\xb1\xd5\xd5\x64",
			"\x9c\x4e\x4e\xd2", "\x49\xa9\xa9\xe0",
			"\xd8\x6c\x6c\xb4", "\xac\x56\x56\xfa",
			"\xf3\xf4\xf4\x07", "\xcf\xea\xea\x25",
			"\xca\x65\x65\xaf", "\xf4\x7a\x7a\x8e",
			"\x47\xae\xae\xe9", "\x10\x08\x08\x18",
		},
		{
			"\x6f\xba\xba\xd5", "\xf0\x78\x78\x88",
			"\x4a\x25\x25\x6f", "\x5c\x2e\x2e\x72",
			"\x38\x1c\x1c\x24", "\x57\xa6\xa6\xf1",
			"\x73\xb4\xb4\xc7", "\x97\xc6\xc6\x51",
			"\xcb\xe8\xe8\x23", "\xa1\xdd\xdd\x7c",
			"\xe8\x74\x74\x9c", "\x3e\x1f\x1f\x21",
			"\x96\x4b\x4b\xdd", "\x61\xbd\xbd\xdc",
			"\x0d\x8b\x8b\x86", "\x0f\x8a\x8a\x85",
		},
		{
			"\xe0\x70\x70\x90", "\x7c\x3e\x3e\x42",
			"\x71\xb5\xb5\xc4", "\xcc\x66\x66\xaa",
			"\x90\x48\x48\xd8", "\x06\x03\x03\x05",
			"\xf7\xf6\xf6\x01", "\x1c\x0e\x0e\x12",
			"\xc2\x61\x61\xa3", "\x6a\x35\x35\x5f",
			"\xae\x57\x57\xf9", "\x69\xb9\xb9\xd0",
			"\x17\x86\x86\x91", "\x99\xc1\xc1\x58",
			"\x3a\x1d\x1d\x27", "\x27\x9e\x9e\xb9",
		},
		{
			"\xd9\xe1\xe1\x38", "\xeb\xf8\xf8\x13",
			"\x2b\x98\x98\xb3", "\x22\x11\x11\x33",
			"\xd2\x69\x69\xbb", "\xa9\xd9\xd9\x70",
			"\x07\x8e\x8e\x89", "\x33\x94\x94\xa7",
			"\x2d\x9b\x9b\xb6", "\x3c\x1e\x1e\x22",
			"\x15\x87\x87\x92", "\xc9\xe9\xe9\x20",
			"\x87\xce\xce\x49", "\xaa\x55\x55\xff",
			"\x50\x28\x28\x78", "\xa5\xdf\xdf\x7a",
		},
		{
			"\x03\x8c\x8c\x8f", "\x59\xa1\xa1\xf8",
			"\x09\x89\x89\x80", "\x1a\x0d\x0d\x17",
			"\x65\xbf\xbf\xda", "\xd7\xe6\xe6\x31",
			"\x84\x42\x42\xc6", "\xd0\x68\x68\xb8",
			"\x82\x41\x41\xc3", "\x29\x99\x99\xb0",
			"\x5a\x2d\x2d\x77", "\x1e\x0f\x0f\x11",
			"\x7b\xb0\xb0\xcb", "\xa8\x54\x54\xfc",
			"\x6d\xbb\xbb\xd6", "\x2c\x16\x16\x3a",
		},
	};

uint8_t *comb_inv_mixcol_tab[][16] = {
		{
			"\x51\xf4\xa7\x50", "\x7e\x41\x65\x53",
			"\x1a\x17\xa4\xc3", "\x3a\x27\x5e\x96",
			"\x3b\xab\x6b\xcb", "\x1f\x9d\x45\xf1",
			"\xac\xfa\x58\xab", "\x4b\xe3\x03\x93",
			"\x20\x30\xfa\x55", "\xad\x76\x6d\xf6",
			"\x88\xcc\x76\x91", "\xf5\x02\x4c\x25",
			"\x4f\xe5\xd7\xfc", "\xc5\x2a\xcb\xd7",
			"\x26\x35\x44\x80", "\xb5\x62\xa3\x8f",
		},
		{
			"\xde\xb1\x5a\x49", "\x25\xba\x1b\x67",
			"\x45\xea\x0e\x98", "\x5d\xfe\xc0\xe1",
			"\xc3\x2f\x75\x02", "\x81\x4c\xf0\x12",
			"\x8d\x46\x97\xa3", "\x6b\xd3\xf9\xc6",
			"\x03\x8f\x5f\xe7", "\x15\x92\x9c\x95",
			"\xbf\x6d\x7a\xeb", "\x95\x52\x59\xda",
			"\xd4\xbe\x83\x2d", "\x58\x74\x21\xd3",
			"\x49\xe0\x69\x29", "\x8e\xc9\xc8\x44",
		},
		{
			"\x75\xc2\x89\x6a", "\xf4\x8e\x79\x78",
			"\x99\x58\x3e\x6b", "\x27\xb9\x71\xdd",
			"\xbe\xe1\x4f\xb6", "\xf0\x88\xad\x17",
			"\xc9\x20\xac\x66", "\x7d\xce\x3a\xb4",
			"\x63\xdf\x4a\x18", "\xe5\x1a\x31\x82",
			"\x97\x51\x33\x60", "\x62\x53\x7f\x45",
			"\xb1\x64\x77\xe0", "\xbb\x6b\xae\x84",
			"\xfe\x81\xa0\x1c", "\xf9\x08\x2b\x94",
		},
		{
			"\x70\x48\x68\x58", "\x8f\x45\xfd\x19",
			"\x94\xde\x6c\x87", "\x52\x7b\xf8\xb7",
			"\xab\x73\xd3\x23", "\x72\x4b\x02\xe2",
			"\xe3\x1f\x8f\x57", "\x66\x55\xab\x2a",
			"\xb2\xeb\x28\x07", "\x2f\xb5\xc2\x03",
			"\x86\xc5\x7b\x9a", "\xd3\x37\x08\xa5",
			"\x30\x28\x87\xf2", "\x23\xbf\xa5\xb2",
			"\x02\x03\x6a\xba", "\xed\x16\x82\x5c",
		},
		{
			"\x8a\xcf\x1c\x2b", "\xa7\x79\xb4\x92",
			"\xf3\x07\xf2\xf0", "\x4e\x69\xe2\xa1",
			"\x65\xda\xf4\xcd", "\x06\x05\xbe\xd5",
			"\xd1\x34\x62\x1f", "\xc4\xa6\xfe\x8a",
			"\x34\x2e\x53\x9d", "\xa2\xf3\x55\xa0",
			"\x05\x8a\xe1\x32", "\xa4\xf6\xeb\x75",
			"\x0b\x83\xec\x39", "\x40\x60\xef\xaa",
			"\x5e\x71\x9f\x06", "\xbd\x6e\x10\x51",
		},
		{
			"\x3e\x21\x8a\xf9", "\x96\xdd\x06\x3d",
			"\xdd\x3e\x05\xae", "\x4d\xe6\xbd\x46",
			"\x91\x54\x8d\xb5", "\x71\xc4\x5d\x05",
			"\x04\x06\xd4\x6f", "\x60\x50\x15\xff",
			"\x19\x98\xfb\x24", "\xd6\xbd\xe9\x97",
			"\x89\x40\x43\xcc", "\x67\xd9\x9e\x77",
			"\xb0\xe8\x42\xbd", "\x07\x89\x8b\x88",
			"\xe7\x19\x5b\x38", "\x79\xc8\xee\xdb",
		},
		{
			"\xa1\x7c\x0a\x47", "\x7c\x42\x0f\xe9",
			"\xf8\x84\x1e\xc9", "\x00\x00\x00\x00",
			"\x09\x80\x86\x83", "\x32\x2b\xed\x48",
			"\x1e\x11\x70\xac", "\x6c\x5a\x72\x4e",
			"\xfd\x0e\xff\xfb", "\x0f\x85\x38\x56",
			"\x3d\xae\xd5\x1e", "\x36\x2d\x39\x27",
			"\x0a\x0f\xd9\x64", "\x68\x5c\xa6\x21",
			"\x9b\x5b\x54\xd1", "\x24\x36\x2e\x3a",
		},
		{
			"\x0c\x0a\x67\xb1", "\x93\x57\xe7\x0f",
			"\xb4\xee\x96\xd2", "\x1b\x9b\x91\x9e",
			"\x80\xc0\xc5\x4f", "\x61\xdc\x20\xa2",
			"\x5a\x77\x4b\x69", "\x1c\x12\x1a\x16",
			"\xe2\x93\xba\x0a", "\xc0\xa0\x2a\xe5",
			"\x3c\x22\xe0\x43", "\x12\x1b\x17\x1d",
			"\x0e\x09\x0d\x0b", "\xf2\x8b\xc7\xad",
			"\x2d\xb6\xa8\xb9", "\x14\x1e\xa9\xc8",
		},
		{
			"\x57\xf1\x19\x85", "\xaf\x75\x07\x4c",
			"\xee\x99\xdd\xbb", "\xa3\x7f\x60\xfd",
			"\xf7\x01\x26\x9f", "\x5c\x72\xf5\xbc",
			"\x44\x66\x3b\xc5", "\x5b\xfb\x7e\x34",
			"\x8b\x43\x29\x76", "\xcb\x23\xc6\xdc",
			"\xb6\xed\xfc\x68", "\xb8\xe4\xf1\x63",
			"\xd7\x31\xdc\xca", "\x42\x63\x85\x10",
			"\x13\x97\x22\x40", "\x84\xc6\x11\x20",
		},
		{
			"\x85\x4a\x24\x7d", "\xd2\xbb\x3d\xf8",
			"\xae\xf9\x32\x11", "\xc7\x29\xa1\x6d",
			"\x1d\x9e\x2f\x4b", "\xdc\xb2\x30\xf3",
			"\x0d\x86\x52\xec", "\x77\xc1\xe3\xd0",
			"\x2b\xb3\x16\x6c", "\xa9\x70\xb9\x99",
			"\x11\x94\x48\xfa", "\x47\xe9\x64\x22",
			"\xa8\xfc\x8c\xc4", "\xa0\xf0\x3f\x1a",
			"\x56\x7d\x2c\xd8", "\x22\x33\x90\xef",
		},
		{
			"\x87\x49\x4e\xc7", "\xd9\x38\xd1\xc1",
			"\x8c\xca\xa2\xfe", "\x98\xd4\x0b\x36",
			"\xa6\xf5\x81\xcf", "\xa5\x7a\xde\x28",
			"\xda\xb7\x8e\x26", "\x3f\xad\xbf\xa4",
			"\x2c\x3a\x9d\xe4", "\x50\x78\x92\x0d",
			"\x6a\x5f\xcc\x9b", "\x54\x7e\x46\x62",
			"\xf6\x8d\x13\xc2", "\x90\xd8\xb8\xe8",
			"\x2e\x39\xf7\x5e", "\x82\xc3\xaf\xf5",
		},
		{
			"\x9f\x5d\x80\xbe", "\x69\xd0\x93\x7c",
			"\x6f\xd5\x2d\xa9", "\xcf\x25\x12\xb3",
			"\xc8\xac\x99\x3b", "\x10\x18\x7d\xa7",
			"\xe8\x9c\x63\x6e", "\xdb\x3b\xbb\x7b",
			"\xcd\x26\x78\x09", "\x6e\x59\x18\xf4",
			"\xec\x9a\xb7\x01", "\x83\x4f\x9a\xa8",
			"\xe6\x95\x6e\x65", "\xaa\xff\xe6\x7e",
			"\x21\xbc\xcf\x08", "\xef\x15\xe8\xe6",
		},
		{
			"\xba\xe7\x9b\xd9", "\x4a\x6f\x36\xce",
			"\xea\x9f\x09\xd4", "\x29\xb0\x7c\xd6",
			"\x31\xa4\xb2\xaf", "\x2a\x3f\x23\x31",
			"\xc6\xa5\x94\x30", "\x35\xa2\x66\xc0",
			"\x74\x4e\xbc\x37", "\xfc\x82\xca\xa6",
			"\xe0\x90\xd0\xb0", "\x33\xa7\xd8\x15",
			"\xf1\x04\x98\x4a", "\x41\xec\xda\xf7",
			"\x7f\xcd\x50\x0e", "\x17\x91\xf6\x2f",
		},
		{
			"\x76\x4d\xd6\x8d", "\x43\xef\xb0\x4d",
			"\xcc\xaa\x4d\x54", "\xe4\x96\x04\xdf",
			"\x9e\xd1\xb5\xe3", "\x4c\x6a\x88\x1b",
			"\xc1\x2c\x1f\xb8", "\x46\x65\x51\x7f",
			"\x9d\x5e\xea\x04", "\x01\x8c\x35\x5d",
			"\xfa\x87\x74\x73", "\xfb\x0b\x41\x2e",
			"\xb3\x67\x1d\x5a", "\x92\xdb\xd2\x52",
			"\xe9\x10\x56\x33", "\x6d\xd6\x47\x13",
		},
		{
			"\x9a\xd7\x61\x8c", "\x37\xa1\x0c\x7a",
			"\x59\xf8\x14\x8e", "\xeb\x13\x3c\x89",
			"\xce\xa9\x27\xee", "\xb7\x61\xc9\x35",
			"\xe1\x1c\xe5\xed", "\x7a\x47\xb1\x3c",
			"\x9c\xd2\xdf\x59", "\x55\xf2\x73\x3f",
			"\x18\x14\xce\x79", "\x73\xc7\x37\xbf",
			"\x53\xf7\xcd\xea", "\x5f\xfd\xaa\x5b",
			"\xdf\x3d\x6f\x14", "\x78\x44\xdb\x86",
		},
		{
			"\xca\xaf\xf3\x81", "\xb9\x68\xc4\x3e",
			"\x38\x24\x34\x2c", "\xc2\xa3\x40\x5f",
			"\x16\x1d\xc3\x72", "\xbc\xe2\x25\x0c",
			"\x28\x3c\x49\x8b", "\xff\x0d\x95\x41",
			"\x39\xa8\x01\x71", "\x08\x0c\xb3\xde",
			"\xd8\xb4\xe4\x9c", "\x64\x56\xc1\x90",
			"\x7b\xcb\x84\x61", "\xd5\x32\xb6\x70",
			"\x48\x6c\x5c\x74", "\xd0\xb8\x57\x42",
		},
	};

inline uint8_t sbox_lookup(uint8_t sbox[][16], uint8_t c)
{
	return sbox[(c >> 4) & 0xf][(c >> 0) & 0xf];
}

inline uint8_t *mixcol_tab_lookup(
		uint8_t *mc_tab[][16], uint8_t c)
{
	return mc_tab[(c >> 4) & 0xf][(c >> 0) & 0xf];
}

void mix_column(uint8_t *mc_tab[][16], uint8_t *col)
{
	uint32_t mc_col, res = 0;

	/* Byte 0. */
	mc_col = *((uint32_t *)mixcol_tab_lookup(mc_tab, col[0]));
	ROTL32(mc_col, 0);
	res ^= mc_col;
	/* Byte 1. */
	mc_col = *((uint32_t *)mixcol_tab_lookup(mc_tab, col[1]));
	ROTL32(mc_col, 8);
	res ^= mc_col;
	/* Byte 2. */
	mc_col = *((uint32_t *)mixcol_tab_lookup(mc_tab, col[2]));
	ROTL32(mc_col, 16);
	res ^= mc_col;
	/* Byte 3. */
	mc_col = *((uint32_t *)mixcol_tab_lookup(mc_tab, col[3]));
	ROTL32(mc_col, 24);
	res ^= mc_col;

	*((uint32_t *)col) = res;
}

void expand_key(_AES_KEY *key, void *_init_key, int bits)
{
	uint8_t *init_key = (uint8_t *)_init_key;
	uint8_t *rd_key = key->rd_key;
	uint8_t *inv_rd_key = key->inv_rd_key;
	uint8_t *xor_col, *prev_col, *curr_col;
	int nk = bits >> 5, nr = 6 + nk;
	int key_nbytes = nk << 2, curr_bytes;
	int steps = CEIL((nr + 1) * AES_NB, nk);
	int i, j, k;

	key->rounds = nr;

	for (i = 0; i < key_nbytes; i++)
		rd_key[i] = init_key[i];

	curr_bytes = key_nbytes;
	curr_col = rd_key + key_nbytes;
	prev_col = curr_col - 4;
	for (i = 1; i < steps; i++) {
		curr_col[0] = sbox_lookup(sbox, prev_col[1]) ^ c_i[i];
		curr_col[1] = sbox_lookup(sbox, prev_col[2]);
		curr_col[2] = sbox_lookup(sbox, prev_col[3]);
		curr_col[3] = sbox_lookup(sbox, prev_col[0]);

		xor_col = curr_col;
		prev_col = curr_col - key_nbytes;
		for (j = 0; j < nk; j++) {
			if (nk > 6 && j == 4) {
				curr_col[0] = sbox_lookup(sbox, xor_col[0]) ^ prev_col[0];
				curr_col[1] = sbox_lookup(sbox, xor_col[1]) ^ prev_col[1];
				curr_col[2] = sbox_lookup(sbox, xor_col[2]) ^ prev_col[2];
				curr_col[3] = sbox_lookup(sbox, xor_col[3]) ^ prev_col[3];
			} else {
				curr_col[0] = xor_col[0] ^ prev_col[0];
				curr_col[1] = xor_col[1] ^ prev_col[1];
				curr_col[2] = xor_col[2] ^ prev_col[2];
				curr_col[3] = xor_col[3] ^ prev_col[3];
			}
			xor_col = curr_col;
			curr_col += 4;
			prev_col += 4;

			curr_bytes += 4;
			if (curr_bytes == sizeof(key->rd_key))
				break;
		}

		prev_col = curr_col - 4;
	}

	for (i = nr * _AES_BLOCK_SIZE; i >= 0; i -= _AES_BLOCK_SIZE) {
		j = nr * _AES_BLOCK_SIZE - i;
		for (k = 0; k < _AES_BLOCK_SIZE; k++)
			inv_rd_key[j + k] = rd_key[i + k];
	}
	for (i = 1; i < nr; i++)
		for (j = 0; j < _AES_BLOCK_SIZE; j += 4)
			mix_column(inv_mixcol_tab, inv_rd_key + (i * _AES_BLOCK_SIZE) + j);
}

void transform_round(uint8_t *new_st, uint8_t *old_st, int d,
		uint8_t sb[][16], uint8_t *mc_tab[][16])
{
	uint32_t mc_col;
	int col_idx[4];
	int i, base, j, k;

	for (i = 0; i < AES_NB; i++) {
		/* Shift amount simplified for AES. */
		if (d == 1) {
			for (j = 0; j < 4; j++) {
				col_idx[j] = (i < j) ? i - j + AES_NB : i - j;
				col_idx[j] <<= 2;
			}
		} else if (d == -1) {
			for (j = 0; j < 4; j++) {
				col_idx[j] = (i + j >= AES_NB) ? i + j - AES_NB : i + j;
				col_idx[j] <<= 2;
			}
		}

		base = i << 2;
		if (mc_tab) {
			/* Byte 0. */
			mc_col = *((uint32_t *)mixcol_tab_lookup(
					mc_tab, old_st[base + 0]));
			ROTL32(mc_col, 0);
			*((uint32_t *)(new_st + col_idx[0])) ^= mc_col;
			/* Byte 1. */
			mc_col = *((uint32_t *)mixcol_tab_lookup(
					mc_tab, old_st[base + 1]));
			ROTL32(mc_col, 8);
			*((uint32_t *)(new_st + col_idx[1])) ^= mc_col;
			/* Byte 2. */
			mc_col = *((uint32_t *)mixcol_tab_lookup(
					mc_tab, old_st[base + 2]));
			ROTL32(mc_col, 16);
			*((uint32_t *)(new_st + col_idx[2])) ^= mc_col;
			/* Byte 3. */
			mc_col = *((uint32_t *)mixcol_tab_lookup(
					mc_tab, old_st[base + 3]));
			ROTL32(mc_col, 24);
			*((uint32_t *)(new_st + col_idx[3])) ^= mc_col;
		} else {
			for (j = 0; j < 4; j++)
				new_st[col_idx[j] + j] ^= sbox_lookup(sb, old_st[base + j]);
		}
	}
}

void _AES_transform(void *_in, void *_out, int d, _AES_KEY *key)
{
	uint8_t *in = (uint8_t *)_in;
	uint8_t *new_st, *old_st, tmp[_AES_BLOCK_SIZE], *c_ptr;
	uint8_t *rd_key;
	uint8_t (*sb)[16], *(*mc_tab)[16];
	int i;

	if (d == 1) {
		sb = sbox;
		mc_tab = comb_mixcol_tab;
		rd_key = key->rd_key;
	} else if (d == -1) {
		sb = inv_sbox;
		mc_tab = comb_inv_mixcol_tab;
		rd_key = key->inv_rd_key;
	}

	if (key->rounds & 0x1) {
		old_st = tmp;
		new_st = (uint8_t *)_out;
	} else {
		old_st = (uint8_t *)_out;
		new_st = tmp;
	}

	for (i = 0; i < _AES_BLOCK_SIZE; i++)
		old_st[i] = in[i] ^ rd_key[i];
	rd_key += _AES_BLOCK_SIZE;

	for (i = 1; i < key->rounds; i++) {
		memcpy(new_st, rd_key, _AES_BLOCK_SIZE);
		transform_round(new_st, old_st, d, sb, mc_tab);

		rd_key += _AES_BLOCK_SIZE;
		c_ptr = new_st;
		new_st = old_st;
		old_st = c_ptr;
	}

	memcpy(new_st, rd_key, _AES_BLOCK_SIZE);
	transform_round(new_st, old_st, d, sb, NULL);
}

void _AES_encrypt(void *in, void *out, _AES_KEY *key)
{
	_AES_transform(in, out, 1, key);
}

void _AES_decrypt(void *in, void *out, _AES_KEY *key)
{
	_AES_transform(in, out, -1, key);
}

#define KEY  "hello world!"
#define BITS  256

#include <sys/time.h>

void print_elapsed_time(struct timeval *tv_start, struct timeval *tv_end)
{
	long sec, usec;

	sec = tv_end->tv_sec - tv_start->tv_sec;
	usec = tv_end->tv_usec - tv_start->tv_usec;
	usec += sec * 1000000;
	printf("[*]: %ld\n", usec);
}

int main()
{
	SHA256_CTX md_ctx;
	AES_KEY key;
	_AES_KEY _key;
	uint8_t buf[64], nb[32], enb[32];
	int i, len;
	int nk = BITS >> 5, nr = 6 + nk, key_nb = (nr + 1) * AES_NB * 4;
	struct timeval tv_start, tv_end;

	for (len = 0; len < 64; len += 32) {
		SHA256_Init(&md_ctx);
		if (len == 0) {
			SHA256_Update(&md_ctx, KEY, strlen(KEY));
			SHA256_Final(buf, &md_ctx);
		} else {
			SHA256_Update(&md_ctx, buf + len - 32, 32);
			SHA256_Update(&md_ctx, KEY, strlen(KEY));
			SHA256_Final(buf + len, &md_ctx);
		}
	}

	for (i = 0; i < 32; i++)
		nb[i] = '\0';


	AES_set_encrypt_key(buf, BITS, &key);
	hex_dump((uint8_t *)key.rd_key, key_nb);

	gettimeofday(&tv_start, NULL);
	for (i = 0; i < 1024; i++)
		AES_encrypt(nb, enb, &key);
	gettimeofday(&tv_end, NULL);
	print_elapsed_time(&tv_start, &tv_end);
	hex_dump(enb, 16);


	expand_key(&_key, buf, BITS);
	hex_dump(_key.rd_key, key_nb);

	gettimeofday(&tv_start, NULL);
	for (i = 0; i < 1024; i++)
		_AES_encrypt(nb, enb, &_key);
	gettimeofday(&tv_end, NULL);
	print_elapsed_time(&tv_start, &tv_end);
	hex_dump(enb, 16);

	for (i = 0; i < 32; i++)
		nb[i] = enb[i];
	_AES_decrypt(nb, enb, &_key);
	hex_dump(enb, 16);

	return 0;
}

